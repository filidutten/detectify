const eventsData = [
    {
        "title": "Black Hat 2020",
        "description": "One morning, as Gregor Samsa was waking up from anxious dreams, he discovered that in bed he had been changed into a monstrous verminous bug.",
        "country": "USA",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-01-08"
    },
    {
        "title": "Global AppSec SF",
        "description": "He lay on his armour-hard back and saw, as he lifted his head up a little, his brown, arched abdomen divided up into rigid bow-like sections.",
        "country": "USA",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-01-21"
    },
    {
        "title": "Day of Shecurity",
        "description": "From this height the blanket, just about ready to slide off completely, could hardly stay in place.",
        "country": "SE",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-02-12"
    },
    {
        "title": "600Minutes with Detectify",
        "description": "His numerous legs, pitifully thin in comparison to the rest of his circumference, flickered helplessly before his eyes.",
        "country": "SE",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-02-15"
    },
    {
        "title": "London Calling",
        "description": "What’s happened to me, he thought. It was no dream. His room, a proper room for a human being, only somewhat too small, lay quietly between the four well-known walls.",
        "country": "UK",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-02-15"
    },
    {
        "title": "Global AppSec Manchester",
        "description": "Above the table, on which an unpacked collection of sample cloth goods was spread out (Samsa was a traveling salesman).",
        "country": "UK",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-03-03"
    },
    {
        "title": "Hacking in the Public Interest",
        "description": "Hung the picture which he had cut out of an illustrated magazine a little while ago and set in a pretty gilt frame. It was a picture of a woman with a fur hat and a fur boa.",
        "country": "SE",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-03-09"
    },
    {
        "title": "Hacker School #1",
        "description": "She sat erect there, lifting up in the direction of the viewer a solid fur muff into which her entire forearm disappeared.",
        "country": "SE",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-04-21"
    },
    {
        "title": "Hacker School #2",
        "description": "Gregor’s glance then turned to the window. The dreary weather (the rain drops were falling audibly down on the metal window ledge) made him quite melancholy.",
        "country": "UK",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-05-07"
    },
    {
        "title": "Hacker School #3",
        "description": "Why don’t I keep sleeping for a little while longer and forget all this foolishness, he thought. But this was entirely impractical, for he was used to sleeping on his right side.",
        "country": "SE",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-05-12"
    },
    {
        "title": "Hacker School #4",
        "description": "And in his present state he couldn’t get himself into this position. No matter how hard he threw himself onto his right side, he always rolled again onto his back.",
        "country": "UK",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-06-04"
    },
    {
        "title": "Hacker School #5",
        "description": "He must have tried it a hundred times, closing his eyes, so that he would not have to see the wriggling legs.",
        "country": "USA",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-06-16"
    },
    {
        "title": "Hacker School #6",
        "description": "And gave up only when he began to feel a light, dull pain in his side which he had never felt before. O God, he thought, what a demanding job I’ ve chosen!",
        "country": "SE",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-07-05"
    },
    {
        "title": "Hacker School #7",
        "description": "Day in, day out on the road. The stresses of trade are much greater than the work going on at head office, and, in addition to that, I have to deal with the problems of traveling.",
        "country": "SE",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-07-09"
    },
    {
        "title": "Hacker School #8",
        "description": "The worries about train connections, irregular bad food, temporary and constantly changing human relationships which never come from the heart. To hell with it all!.",
        "country": "USA",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-07-14"
    },
    {
        "title": "Hacker School #9",
        "description": "He felt a slight itching on the top of his abdomen. He slowly pushed himself on his back closer to the bed post so that he could lift his head more easily, found the itchy part.",
        "country": "UK",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-07-28"
    },
    {
        "title": "Hacker School #10",
        "description": "Which was entirely covered with small white spots (he did not know what to make of them), and wanted to feel the place with a leg.",
        "country": "USA",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-08-10"
    },
    {
        "title": "hackaaroo 360",
        "description": "But he retracted it immediately, for the contact felt like a cold shower all over him. He slid back again into his earlier position. This getting up early, he thought, makes a man quite idiotic.",
        "country": "USA",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-08-26"
    },
    {
        "title": "Security Conference",
        "description": "A man must have his sleep. Other traveling salesmen live like harem women. For instance, when I come back to the inn during the course of the morning to write up the necessary orders.",
        "country": "UK",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-09-08"
    },
    {
        "title": "Security Bash CA",
        "description": "These gentlemen are just sitting down to breakfast. If I were to try that with my boss, I’d be thrown out on the spot.",
        "country": "USA",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-09-08"
    },
    {
        "title": "Hackza 2020",
        "description": "Still, who knows whether that mightn’t be really good for me. If I didn’t hold back for my parents’ sake, I would’ve quit ages ago. I would’ve gone to the boss and told him just what I think from the bottom of my heart.",
        "country": "USA",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-10-07"
    },
    {
        "title": "Info Panel SE",
        "description": "He would’ve fallen right off his desk! How weird it is to sit up at the desk and talk down to the employee from way up there.",
        "country": "SE",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-10-29"
    },
    {
        "title": "Skillhacking",
        "description": "The boss has trouble hearing, so the employee has to step up quite close to him. Anyway, I haven’t completely given up that hope yet.",
        "country": "UK",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-11-11"
    },
    {
        "title": "Meeting & trust",
        "description": "Once I’ve got together the money to pay off the parents debt to him—that should take another five or six years—I’ll do it for sure.",
        "country": "USA",
        "type": "Online",
        "link": "https://detectify.com/admin",
        "date": "2020-11-19"
    },
    {
        "title": "Hackingwire",
        "description": "Then I’ll make the big break. In any case, right now I have to get up. My train leaves at five o’clock.",
        "country": "SE",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-12-10"
    },
    {
        "title": "SecurityTool",
        "description": "And he looked over at the alarm clock ticking away by the chest of drawers. Good God, he thought. It was half past six, and the hands were going quietly on.",
        "country": "USA",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-12-27"
    },
    {
        "title": "Stealth Defense Gothemburg",
        "description": "It was past the half hour, already nearly quarter to. Could the alarm have failed to ring? One saw from the bed that it was properly set for four o’clock. Certainly it had rung.",
        "country": "SE",
        "type": "Live",
        "link": "https://detectify.com/admin",
        "date": "2020-12-30"
    }
];


eventsData.sort(function(a, b) {
    var c = new Date(a.date);
    var d = new Date(b.date);
    return c-d;
});

const pastDates = eventsData.filter(x => Date.parse(x.date) < new Date());
const futureDates = eventsData.filter(x => Date.parse(x.date) > new Date());

function theDate(date) {

    let formatted_date = Date.parse(date);
    let new_date = new Date(formatted_date);
    let options = {
            month: 'short', day: '2-digit',
        };

    let date_result = new_date.toLocaleDateString('en', options);
    return date_result;
}

function theMonth(date) {

    let formatted_date = Date.parse(date);
    let new_month = new Date(formatted_date);
    let options = {
            month: 'short',
        };

    let month_result = new_month.toLocaleDateString('en', options);
    return month_result;
}

function theYear(date) {

    let formatted_date = Date.parse(date);
    let new_year = new Date(formatted_date);
    let options = {
            year: 'numeric',
        };

    let year_result = new_year.toLocaleDateString('en', options);
    return year_result;
}

function eventTemplate(event) {

    return `
        <div class="event-card ${event.type} swiper-slide ${theMonth(event.date)}">
            <div class="event-header">
                <h4>${theDate(event.date)}<span>${theYear(event.date)}</span></h4>
                <p>${event.country}</p>
            </div>
            <div class="event-body">
                <h3>${event.title}</h3>
                <p class="body2 event-text">${event.description}</p>
            </div>

            <a class="body2 event-button" href="${event.link}">Read more</a>
        </div>
    `
}

document.getElementById('events-wrapper').innerHTML = `

    ${ futureDates.map(eventTemplate).join('') }

`


filterSelection("all");

const swiper = new Swiper('.swiper-container', {
    slidesPerView: 1,
    spaceBetween: 24,
    slidesPerGroup: 1,
    grabCursor: true,
    pagination: {
        el: '.swiper-pagination',
        type: 'bullets',
    },

    breakpoints: {
        480: {
            slidesPerView: 1,
            spaceBetween: 24,
            slidesPerGroup: 1
        },
        769: {
            slidesPerView: 2,
            spaceBetween: 32,
            slidesPerGroup: 2
        },
        1121: {
            slidesPerView: 3,
            spaceBetween: 56,
            slidesPerGroup: 3
        }
    },
    navigation: {
        nextEl: '.button-next',
        prevEl: '.button-prev',
    },
    on: {
        init: function () {
            console.log('swiper initialized');
        },
    },
})


function filterSelection(c) {
    var x, i;
    x = document.getElementsByClassName("event-card");
    if (c == "all") c = "";
    for (i = 0; i < x.length; i++) {
        eventRemoveClass(x[i], "show");
        if (x[i].className.indexOf(c) > -1) eventAddClass(x[i], "show");
    }
}

function eventAddClass(element, name) {
    var i, arr1, arr2;
    arr1 = element.className.split(" ");
    arr2 = name.split(" ");
    for (i = 0; i < arr2.length; i++) {
        if (arr1.indexOf(arr2[i]) == -1) {element.className += " " + arr2[i];}
    }
}

function eventRemoveClass(element, name) {
    var i, arr1, arr2;
    arr1 = element.className.split(" ");
    arr2 = name.split(" ");
    for (i = 0; i < arr2.length; i++) {
        while (arr1.indexOf(arr2[i]) > -1) {
            arr1.splice(arr1.indexOf(arr2[i]), 1);
        }
    }
    element.className = arr1.join(" ");
}




const btnContainer = document.getElementById("btn-container");
const btns = btnContainer.getElementsByClassName("filter-btn");
const titleElem = document.querySelector('.drop-btn p');

for (var i = 0; i < btns.length; i++) {
    btns[i].addEventListener("click", function(){
        var current = document.getElementsByClassName("active");
        current[0].className = current[0].className.replace(" active", "");
        this.className += " active";
    	titleElem.textContent = 'Month';
        removeInlineStyle();
        swiper.update();
    });
}

function removeInlineStyle() {

    let eventContainer = document.getElementById("events-wrapper");
    let eventCard = eventContainer.getElementsByClassName("event-card");

    Array.prototype.forEach.call(eventCard, function(element){
        element.style.removeProperty('display');
    });
}


let hiddenClass = [];
let input = document.getElementById('searchFilter');

input.addEventListener('input', function() {
    var eventc = document.getElementsByClassName('event-card');
    for (var i = 0; i < eventc.length; i++) {
        var ele = eventc[i];
        if (ele.innerHTML.toLowerCase().indexOf(input.value.toLowerCase()) === -1) {
            setVisibility(ele, 'none');
            swiper.update();
        } else {
            isHidden = false;
            var classes = ele.className.split(' ');
            for (var j = 0; j < classes.length; j++) {
                if (hiddenClass.indexOf(classes[j]) !== -1) isHidden = true;
                swiper.update();
            }

            if (!isHidden) {
                setVisibility(ele, 'block');
                swiper.update();
            }
        }
    }
});

function setVisibility(element, block){
    element.style.display = block;
}
//
// function setVisibilityByClass(name, block) {
//     var elements = document.getElementsByClassName(name);
//     for (var i = 0; i < elements.length; i++) {
//         setVisibility(elements[i], block);
//     }
// }

function handleOptionSelected(e){
	const id = e.target.id;
	const newValue = e.target.textContent + ' ';
	const titleElem = document.querySelector('.drop-btn p');

	titleElem.textContent = newValue;

	document.querySelector('.drop-btn p').dispatchEvent(new Event('change'));
    swiper.update();
}

const dropdownTitle = document.querySelector('.drop-btn p');
const dropdownOptions = document.querySelectorAll('.dropdown-content .option');

dropdownOptions.forEach(option => option.addEventListener('click',handleOptionSelected));
